# Quay Configuration
# Generated by Ansible - Do not edit manually
# =============================================

# Server Configuration
SERVER_HOSTNAME: {{ quay_hostname }}
PREFERRED_URL_SCHEME: https

# Database Configuration
DB_URI: postgresql://{{ postgresql_user }}:{{ vault_postgresql_password }}@{{ quay_hostname }}:{{ postgresql_port }}/{{ postgresql_database }}
DATABASE_SECRET_KEY: {{ vault_quay_database_secret }}

# Redis Configuration
BUILDLOGS_REDIS:
  host: {{ quay_hostname }}
  port: {{ redis_port }}
  password: {{ vault_redis_password }}

USER_EVENTS_REDIS:
  host: {{ quay_hostname }}
  port: {{ redis_port }}
  password: {{ vault_redis_password }}

# Secret Key
SECRET_KEY: {{ vault_quay_secret_key }}

# Storage Configuration
DISTRIBUTED_STORAGE_CONFIG:
  default:
    - {{ quay_storage_type }}
    - storage_path: /datastorage/registry

DISTRIBUTED_STORAGE_DEFAULT_LOCATIONS: []
DISTRIBUTED_STORAGE_PREFERENCE:
  - default

# Feature Flags
FEATURE_MAILING: {{ quay_feature_mailing | lower }}
FEATURE_BUILD_SUPPORT: {{ quay_feature_build_support | lower }}
FEATURE_SECURITY_SCANNER: {{ quay_feature_security_scanner | lower }}
FEATURE_REPO_MIRROR: {{ quay_feature_repo_mirror | lower }}

# Namespace Configuration
CREATE_NAMESPACE_ON_PUSH: {{ quay_create_namespace_on_push | lower }}

# Superusers
{% if quay_superusers is defined and quay_superusers | length > 0 %}
SUPER_USERS:
{% for user in quay_superusers %}
  - {{ user }}
{% endfor %}
{% endif %}

# Setup Complete Flag
SETUP_COMPLETE: true

{% if quay_enable_clair %}
# Security Scanner (Clair) Configuration
SECURITY_SCANNER_V4_ENDPOINT: http://{{ quay_hostname }}:{{ clair_http_port }}
SECURITY_SCANNER_V4_NAMESPACE_WHITELIST:
  - admin
SECURITY_SCANNER_NOTIFICATIONS: true
{% endif %}

{% if quay_enable_mirror %}
# Repository Mirroring Configuration
REPO_MIRROR_TLS_VERIFY: true
REPO_MIRROR_SERVER_HOSTNAME: {{ quay_hostname }}
{% endif %}

# SSL/TLS Configuration
{% if quay_ssl_mode != 'none' %}
EXTERNAL_TLS_TERMINATION: false
{% else %}
EXTERNAL_TLS_TERMINATION: true
{% endif %}

# Logging
LOG_ARCHIVE_LOCATION: default
